# README.md

- http://kozos.jp/books/makeos/
    - 著者によるサポートページ

## 用語集

### 2 nd ステップ シリアル通信

- SCI
    - H8のシリアルコントローラ
- SMR(Serial Mode Register)
    - シリアル入出力のパラメータ設定を行います
    - シリアル通信には、ビット数、パリティ、ストップビット長などの各種パラメータがあります
- SCR(Serial Contoroller Register)
    - シリアル入出力の制御を行います
    - 制御とは、送受信の有効/無効の切り替え、割り込みの有効/無効の切り替えなどです
- BRR(Bit Rate Register)
    - シリアル通信の速度(ボーレート)の設定になります
     code:def.txt
- TDR(トランスミットデータレジスタ)
    - シリアルへの1文字出力を行うのに使う
- SSR(シリアルステータスレジスタ)
    - シリアルへの1文字出力を行うのに使う

### 3 rd ステップ 静的変数の読み書き

- PA(Physical Address) / LA(Load Address) / LMA(Load Memory Address)
    - 物理アドレス
    - 変数の初期値が配置されるアドレス
- LA(Logical Address / Link Address) / VA/VMA(Virtual Address)
    - 論理アドレス / リンクアドレス / 仮想アドレス
    - プログラムが変数にアクセスする際のアドレス
- セクション
    - リンク時に同じ内容の領域をリンカがまとめるためのもの
- セグメント
    - プログラムの実行時にローダが参照してメモリ上に展開するためのもの

### 4 th ステップ シリアル経由でファイルを転送する

- アセンブラでないと記述できない部分
    - スタートアップ
    - 割り込みの入り口と出口
    - スレッドのディスパッチ

### 7 th ステップ 割り込み処理を実装する

- 割込み
    1. 外部ハードウェアによって割込み線がアサートされることで発生する割込み
    2. 不正メモリアクセスやゼロ除算などにより CPU 内部で発生する割込み(例外)
    3. システムコール命令やトラップ命令などによりプログラム側から「わざと」発生させる割込み
- 一般的な CPU では、割込み発生時に次の値が自動的に保存される
    - プログラムカウンタ
    - モードレジスタ
        - 動作モードの設定を持っているレジスタ
            - 動作モードには以下のようなものがある
                - 割込み禁止
                - 特権もーととユーザーモード
                - メモリ保護の有効無効の切り替え
                - 仮想メモリによるアドレス変換の有効無効の切り替え

#### 割り込みハンドラの入り口

- 割り込み発生時に自動的に保存されるレジスタは、CPUの回路が複雑になるのを避けるために、一部のものに限られる
- しかし、割込み処理の内容は多岐にわたるため、それをCPUの汎用レジスタを利用せずに行うことは現実的に不可能
- そこで、割込みハンドラの最初の部分で次の処理を行う必要がある
    - 汎用レジスタの値をどこかに保存しておく
    - その他、プログラム中で利用しているレジスタの値も保存しておく
- そして、割込みハンドラの終わりの部分で割込み復帰命令を実行する前に、次の処理が必要になる
    - 汎用レジスタの値を保存先から復旧する
    - その他、プログラム中で利用しているレジスタの値も復旧する

## Commands

```bash
# xmode を cme.exe から実行する時のコマンド
kz_xmodem.exe ..\..\01\bootload\kzload.elf COM4

kz_xmodem.exe ..\..\01\os\kozos COM4
```
